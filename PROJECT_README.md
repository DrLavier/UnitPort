# UnitPort / PROJECT_README

## 1. 项目概述
UnitPort 是一个跨平台机器人编程统一框架，目标是把 **可视化任务编排（Canvas）**、**源码编程（Compiler）** 与 **场景化执行配置（Scenario）** 融合为一套一致的工程系统。

核心价值：
- 同一任务可在仿真与真机之间切换执行。
- 通过 Service 适配层屏蔽厂商 SDK 差异，支持后续热插拔扩展。
- 通过 Runtime 执行内核在“编译期 + 执行期”进行全程拦截和约束（包含 Safety 机制）。

---

## 2. 最终架构（已确认）

### 2.1 四个设计层
- Mission
- Behavior
- Service
- Runtime（内含 Safety 执行拦截子系统）

### 2.2 三个交互层
- Canvas
- Compiler
- Scenario

### 2.3 分层关系（简图）
```text
[Canvas] ----> [Mission] ----\
                              > [Runtime(+Safety)] --> [Service] --> [SDK/Robot]
[Compiler] --> [Behavior] ---/

[Scenario] --> Runtime 参数、执行策略、安全协议、仿真/真机目标
```

---

## 3. 向量化名词定义（设计层）
> 说明：每个名词按 `{搭建原则, 功能解释}` 两个维度定义。

| 设计层 | 搭建原则（向量维度1） | 功能解释（向量维度2） |
|---|---|---|
| `Mission` | 只描述“做什么”，不耦合 SDK 与底层控制细节；优先图结构与可组合性 | 负责项目级任务流编排（节点连接、阶段顺序、主干流程） |
| `Behavior` | 只描述“怎么做”，通过状态机/策略封装动作细节；可复用、可打包为 Node | 负责单节点内部行为逻辑（参数调优、条件分支、传感器反馈策略、插件/智能体调用） |
| `Service` | 对上提供统一能力接口，对下适配具体厂商 SDK；版本差异在此层消化 | 负责 Mission/Behavior 到原机 SDK 的协议转译、能力映射、调用封装 |
| `Runtime` | 事件驱动、可观测、可中断；执行时必须具备全程拦截能力（Safety 内嵌） | 负责任务调度、资源仲裁、执行监控、仿真/真机切换、异常处理与安全拦截 |

---

## 4. 向量化名词定义（交互层）
> 说明：每个名词按 `{搭建原则, 功能解释}` 两个维度定义。

| 交互层 | 搭建原则（向量维度1） | 功能解释（向量维度2） |
|---|---|---|
| `Canvas` | 面向任务与流程表达，强调低门槛编排；输出结构化任务图 | 用 Node 可视化搭建 Mission；连接任务阶段、流程分支和执行路径 |
| `Compiler` | 面向精细控制与可编程扩展；与 Canvas 共用同一语义模型 | 用源码方式定义/微调 Behavior（电机参数、传感器逻辑、LLM/Agent 插件调用） |
| `Scenario` | 面向执行目标与运行环境，不定义业务逻辑；配置可复现 | 配置仿真场景、真机连接、运行参数、安全协议，并驱动 Runtime Control & Overseen |

---

## 5. Safety 在本方案中的位置（最终口径）
Safety 不单列为独立设计层，而是 **Runtime 的强约束子系统**，在以下阶段持续生效：

- 编译期拦截：参数边界、能力不匹配、危险行为静态检查
- 执行前拦截：环境与连接检查、任务准入检查
- 执行中拦截：阈值监控、资源冲突检查、超时/异常处理
- 执行后处理：降级、回退、急停、审计日志

结论：Safety 不是简单 `try/catch`，而是 Runtime 的系统级策略执行机制。

---

## 6. 端到端工作流
1. 用户在 `Canvas` 组装 Mission 主流程。
2. 用户在 Node 内通过 `Canvas + Compiler` 配置 Behavior 并封装为可复用 Node。
3. `Scenario` 配置目标环境（仿真/真机）、连接参数、执行策略、安全协议。
4. `Runtime` 接收 Mission + Behavior + Scenario，执行调度与安全拦截。
5. `Service` 将统一指令转译到对应厂商 SDK。
6. 机器人执行并回传状态，Runtime 统一监控与反馈。

---

## 7. 对当前项目的落地指导

### 7.1 前端侧
- `Canvas`：任务图编辑、节点连接、阶段编排。
- `Compiler`：行为脚本编辑、参数模板、插件接口。
- `Scenario`：仿真/真机开关、运行配置、安全规则面板。

### 7.2 后端侧
- `Mission`：任务图模型与编排语义。
- `Behavior`：节点行为引擎（状态机、策略执行）。
- `Runtime`：调度器、监控器、拦截器（Safety 内置）。
- `Service`：SDK 适配器与能力路由。

### 7.3 SDK 扩展策略
- 新厂商接入只新增/替换 Service Adapter。
- Mission/Behavior/Scenario 语义保持不变。
- Runtime 保持统一执行与统一安全口径。

---

## 8. 关键设计原则（必须遵守）
- 单一语义源：Canvas 与 Compiler 最终表达必须收敛到同一任务语义。
- 低耦合：Mission/Behavior 不直接调用厂商 SDK。
- 可替换：Service Adapter 可插拔，Runtime 不感知具体品牌实现。
- 可审计：所有拦截、异常、回退行为必须可追踪。
- 可迁移：同一任务优先支持“先仿真验证，再真机执行”。

---

## 9. 本文档用途
本文件为当前项目的统一架构口径与实施核对基线。后续产品设计、节点扩展、SDK 接入、执行安全策略均以本文件为准。
